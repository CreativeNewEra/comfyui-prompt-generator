<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComfyUI Prompt Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode" aria-label="Toggle Dark Mode">
                <span id="themeIcon">üåô</span>
            </button>
            <h1>üé® ComfyUI Prompt Generator</h1>
            <p>Powered by local Ollama - uncensored and private</p>
            <div style="margin-top: 15px;">
                <button class="btn-history" id="historyBtn">üìú History (H)</button>
            </div>
        </div>

        <div class="card">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="oneshot">‚ö° Quick Generate</button>
                <button class="mode-btn" data-mode="chat">üí¨ Chat & Refine</button>
            </div>

            <div class="model-selector">
                <button class="model-btn active" data-model="flux">Flux Dev</button>
                <button class="model-btn" data-model="sdxl">SDXL (Juggernaut)</button>
            </div>

            <div class="preset-group" style="margin-bottom: 20px;">
                <label for="ollamaModelSelect">ü§ñ Ollama Model:</label>
                <select id="ollamaModelSelect" class="preset-select">
                    <option value="">Loading models...</option>
                </select>
            </div>

            <div class="preset-group" style="margin-bottom: 20px;">
                <label for="personaSelect">üé≠ AI Persona (Optional):</label>
                <select id="personaSelect" class="preset-select">
                    <option value="">None (Standard)</option>
                </select>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Choose an AI personality to guide your prompts
                </small>
            </div>

            <div class="streaming-section">
                <label for="streamingToggle">
                    <span>‚ö° Enable Streaming</span>
                    <label class="streaming-toggle">
                        <input type="checkbox" id="streamingToggle">
                        <span class="streaming-slider"></span>
                    </label>
                </label>
                <span class="streaming-info">(See prompts generated in real-time)</span>
            </div>

            <div class="quick-presets-section">
                <h3>‚ö° Quick Presets</h3>
                <div class="quick-preset-category">
                    <label>Styles:</label>
                    <div class="quick-preset-group">
                        <button class="quick-preset-btn" data-category="style" data-value="Cinematic">Cinematic</button>
                        <button class="quick-preset-btn" data-category="style" data-value="Photorealistic">Photorealistic</button>
                        <button class="quick-preset-btn" data-category="style" data-value="Anime">Anime</button>
                        <button class="quick-preset-btn" data-category="style" data-value="Cyberpunk">Cyberpunk</button>
                        <button class="quick-preset-btn" data-category="style" data-value="Impressionist">Impressionist</button>
                        <button class="quick-preset-btn" data-category="style" data-value="Synthwave">Synthwave</button>
                    </div>
                </div>
                <div class="quick-preset-category">
                    <label>Artists:</label>
                    <div class="quick-preset-group">
                        <button class="quick-preset-btn" data-category="artist" data-value="Greg Rutkowski">Greg Rutkowski</button>
                        <button class="quick-preset-btn" data-category="artist" data-value="Ansel Adams">Ansel Adams</button>
                        <button class="quick-preset-btn" data-category="artist" data-value="Studio Ghibli">Studio Ghibli</button>
                        <button class="quick-preset-btn" data-category="artist" data-value="Beeple">Beeple</button>
                        <button class="quick-preset-btn" data-category="artist" data-value="Claude Monet">Claude Monet</button>
                    </div>
                </div>
                <div class="quick-preset-category">
                    <label>Composition:</label>
                    <div class="quick-preset-group">
                        <button class="quick-preset-btn" data-category="composition" data-value="Portrait">Portrait</button>
                        <button class="quick-preset-btn" data-category="composition" data-value="Landscape">Landscape</button>
                        <button class="quick-preset-btn" data-category="composition" data-value="Low Angle">Low Angle</button>
                        <button class="quick-preset-btn" data-category="composition" data-value="Panorama">Panorama</button>
                        <button class="quick-preset-btn" data-category="composition" data-value="Macro Detail">Macro Detail</button>
                    </div>
                </div>
                <div class="quick-preset-category">
                    <label>Lighting:</label>
                    <div class="quick-preset-group">
                        <button class="quick-preset-btn" data-category="lighting" data-value="Golden Hour">Golden Hour</button>
                        <button class="quick-preset-btn" data-category="lighting" data-value="Neon Lighting">Neon</button>
                        <button class="quick-preset-btn" data-category="lighting" data-value="Volumetric">Volumetric</button>
                        <button class="quick-preset-btn" data-category="lighting" data-value="Soft Diffused">Soft Diffused</button>
                        <button class="quick-preset-btn" data-category="lighting" data-value="Bioluminescent">Bioluminescent</button>
                    </div>
                </div>
            </div>

            <div class="favorites-section">
                <div class="favorites-header">
                    <h3>‚≠ê Favorites</h3>
                    <button class="btn-save-favorite" id="saveFavoriteBtn">üíæ Save Current</button>
                </div>
                <div class="favorites-chips" id="favoritesChips">
                    <span class="favorites-empty">No favorites yet. Select presets and click "Save Current" to create one!</span>
                </div>
            </div>

            <div class="presets-section">
                <h3>üé® Hierarchical Presets (Optional)</h3>
                <p style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px;">
                    Select category ‚Üí type ‚Üí artist for detailed presets
                </p>
                <div class="presets-grid">
                    <div class="preset-group">
                        <label for="categorySelect">üìÇ Category:</label>
                        <select id="categorySelect" class="preset-select">
                            <option value="">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="typeSelect">üìë Type:</label>
                        <select id="typeSelect" class="preset-select" disabled>
                            <option value="">Select category first</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="artistStyleSelect">üé® Artist/Style:</label>
                        <select id="artistStyleSelect" class="preset-select" disabled>
                            <option value="">Select type first</option>
                        </select>
                    </div>
                </div>

                <!-- Legacy presets (hidden when hierarchical enabled) -->
                <div id="legacyPresets" class="presets-grid" style="display: none;">
                    <div class="preset-group">
                        <label for="styleSelect">Style:</label>
                        <select id="styleSelect" class="preset-select">
                            <option value="None">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="artistSelect">Artist/Photographer:</label>
                        <select id="artistSelect" class="preset-select">
                            <option value="None">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="compositionSelect">Composition:</label>
                        <select id="compositionSelect" class="preset-select">
                            <option value="None">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="lightingSelect">Lighting:</label>
                        <select id="lightingSelect" class="preset-select">
                            <option value="None">None</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Preset Packs Quick Start -->
            <div class="presets-section" id="presetPacksSection" style="display: none;">
                <h3>‚ö° Quick Start Preset Packs</h3>
                <p style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px;">
                    One-click professional preset combinations
                </p>
                <div id="presetPacksContainer" class="preset-packs-grid">
                    <!-- Preset pack buttons will be loaded here -->
                </div>
            </div>

            <!-- Universal Options -->
            <div class="presets-section" id="universalOptionsSection" style="display: none;">
                <h3>üåü Additional Options (Optional)</h3>
                <p style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px;">
                    Fine-tune atmosphere, mood, and style
                </p>
                <div class="presets-grid">
                    <div class="preset-group">
                        <label for="moodSelect">üòä Mood:</label>
                        <select id="moodSelect" class="preset-select" multiple size="3">
                            <option value="">Loading...</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="timeOfDaySelect">üåÖ Time of Day:</label>
                        <select id="timeOfDaySelect" class="preset-select">
                            <option value="">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="universalLightingSelect">üí° Lighting:</label>
                        <select id="universalLightingSelect" class="preset-select">
                            <option value="">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="weatherSelect">üå¶ Weather/Atmosphere:</label>
                        <select id="weatherSelect" class="preset-select">
                            <option value="">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="colorPaletteSelect">üé® Color Palette:</label>
                        <select id="colorPaletteSelect" class="preset-select">
                            <option value="">None</option>
                        </select>
                    </div>

                    <div class="preset-group">
                        <label for="cameraEffectsSelect">üì∑ Camera Effects:</label>
                        <select id="cameraEffectsSelect" class="preset-select" multiple size="3">
                            <option value="">None</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="error" id="error"></div>

            <div class="chat-history" id="chatHistory"></div>

            <div class="input-area">
                <label for="userInput" id="inputLabel">Describe what you want to generate:</label>
                <textarea id="userInput" placeholder="Example: a cyberpunk character with neon hair..."></textarea>
            </div>

            <div class="actions">
                <button class="btn btn-primary" id="generateBtn">Generate Prompt</button>
                <button class="btn btn-stop" id="stopBtn">‚èπ Stop</button>
                <button class="btn btn-secondary" id="resetBtn" style="display: none;">New Conversation</button>
            </div>

            <div class="streaming-indicator" id="streamingIndicator">ü§ñ Streaming response</div>
            <div class="loading" id="loading">ü§ñ Thinking...</div>

            <div class="output-area" id="outputArea">
                <div class="output-box">
                    <h3>Generated Prompt:</h3>
                    <button class="copy-btn" id="copyBtn">Copy</button>
                    <div class="output-content" id="output"></div>
                </div>
            </div>

            <div class="tips">
                <h3>üí° Tips:</h3>
                <ul>
                    <li><strong>Quick Generate:</strong> Describe your idea, get a prompt instantly</li>
                    <li><strong>Chat Mode:</strong> Have a conversation to refine and iterate on ideas</li>
                    <li><strong>Quick Presets:</strong> Click pill-shaped buttons for instant preset selection - faster than dropdowns! Click again to toggle off</li>
                    <li><strong>‚ö° Streaming (NEW!):</strong> Enable streaming to watch prompts appear in real-time with smooth animations and a blinking cursor! Automatically falls back to normal mode if issues occur. Click "Stop" to cancel anytime.</li>
                    <li><strong>Favorites:</strong> Save your favorite preset combinations! Click "Save Current" to create one, then click any favorite to instantly apply it</li>
                    <li><strong>Presets:</strong> Use style, artist, composition, and lighting dropdowns for instant enhancements</li>
                    <li><strong>Flux:</strong> Best with natural language, very detailed descriptions</li>
                    <li><strong>SDXL:</strong> Works great with quality tags and negative prompts</li>
                    <li>Mix and match presets - try combining different styles with specific lighting</li>
                    <li>Quick presets and dropdowns stay in sync - use whichever you prefer!</li>
                    <li>Hover over favorites to rename or delete them</li>
                    <li>Presets are optional - leave them on "None" for full AI creativity</li>
                    <li>Press 'H' to quickly open prompt history, ESC to close</li>
                    <li>Everything runs locally - no censorship, total privacy</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="history-overlay" id="historyOverlay">
        <div class="history-modal">
            <div class="history-header">
                <h2>üìú Prompt History</h2>
                <button class="history-close-btn" id="historyCloseBtn">√ó</button>
            </div>
            <div class="history-search">
                <input type="text" id="historySearchInput" placeholder="üîç Search history...">
            </div>
            <div class="history-content" id="historyContent">
                <div class="history-empty">
                    <h3>No history yet</h3>
                    <p>Generated prompts will appear here</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/presets.js') }}"></script>
    <script src="{{ url_for('static', filename='js/personas.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
